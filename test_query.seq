include "src/term"

# Non-recursive version - just return the term for unbound vars
: deref-once ( Term Subst -- Term )
  over tvar? if
    over tvar-id over subst-lookup
    if
      nip nip  # value is now on top
    else
      drop drop  # drop value, drop Subst, keep Term
    then
  else
    drop  # just drop Subst, keep Term
  then
;

# Loop-based deref using a quotation for iteration
: my-deref ( Term Subst -- Term )
  # For now, just do single-level dereference
  deref-once
;

: main ( -- )
  "=== Test ===" io.write-line
  
  "X" 100 tvar
  subst-empty
  
  "Calling my-deref..." io.write-line
  my-deref
  "my-deref returned" io.write-line
  
  drop
;
