include "src/parser"

: main ( -- )
  "=== Testing variable parsing ===" io.write-line

  # Tokenize "foo(X)."
  "foo(X)." tokenize

  # Parse it with counter 0
  0 parse-term-with-counter

  # Stack: result counter
  over variant.tag int->string "Parse done, result tag = " swap string.concat io.write-line
  over parse-ok-term? if
    "Parse succeeded" io.write-line
    over parse-term-value  # get the term

    # Stack: result counter term
    "Term tag = " over variant.tag int->string string.concat io.write-line

    dup tcompound? if
      "Term is compound: " over tcompound-functor string.concat io.write-line

      dup tcompound-args
      # Stack: result counter term args
      "Args tag = " over variant.tag int->string string.concat io.write-line

      tlcar
      # Stack: result counter term first_arg
      "First arg tag = " over variant.tag int->string string.concat io.write-line

      dup tvar? if
        "First arg is variable" io.write-line
        dup tvar-name "  Name: " swap string.concat io.write-line
        tvar-id "  ID: " swap int->string string.concat io.write-line
      else
        drop "First arg is not variable" io.write-line
      then

      drop  # drop term
    else
      drop "Term is not compound" io.write-line
    then
  else
    "Parse failed" io.write-line
  then

  drop drop  # clean up result and counter
;
